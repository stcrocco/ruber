<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Ruber::AutoEnd::Extension
  
    &mdash; Ruber API
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (E)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Ruber.html" title="Ruber (module)">Ruber</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../AutoEnd.html" title="Ruber::AutoEnd (module)">AutoEnd</a></span></span>
     &raquo; 
    <span class="title">Extension</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Ruber::AutoEnd::Extension
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Qt::Object</span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Qt::Object</li>
          
            <li class="next">Ruber::AutoEnd::Extension</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="../Extension.html" title="Ruber::Extension (module)">Extension</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">plugins/auto_end/auto_end.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Extension object for the Auto End plugin</p>
<p>The procedure of inserting an <code>end</code> is split in two parts, performed in separate
moments:</p>
<ol>
	<li>finding out whether the current line needs an end inserted after it. This is
  done in response to the <span class='object_link'><a href="../Document.html#text_inserted-signalcode" title="Ruber::Document#text_inserted (signalcode)">Document#text_inserted</a></span> signal</li>
	<li>inserting the text. This is done in response to the <span class='object_link'><a href="../Document.html#text_changed-signalcode" title="Ruber::Document#text_changed (signalcode)">Document#text_changed</a></span> signal</li>
</ol>
<p>The reason for this two-step behaviour is that <span class='object_link'><a href="../Document.html#text_inserted-signalcode" title="Ruber::Document#text_inserted (signalcode)">Document#text_inserted</a></span> is emitted
multiple times in case of a Paste operation. Thus, inserting the <code>end</code> keywords
in it would cause them to be added in the middle of the pasted text, which is
wrong. What we do instead is to analyze each line in response to <span class='object_link'><a href="../Document.html#text_inserted-signalcode" title="Ruber::Document#text_inserted (signalcode)">Document#text_inserted</a></span>,
storing the line position and the text to insert if appropriate, overwriting any
other information so that only the last position is recorded. When all text has
been processed, the document emits the <span class='object_link'><a href="../Document.html#text_changed-signalcode" title="Ruber::Document#text_changed (signalcode)">Document#text_changed</a></span> signal and, in response
to this we insert the end keyword (if appropriate).</p>

  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
   
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Extension/Insertion.html" title="Ruber::AutoEnd::Extension::Insertion (class)">Insertion</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="IDENTIFIER_PATTERN-constant" class="">IDENTIFIER_PATTERN =
          <div class="docstring">
  <div class="discussion">
    <p>The regexp fragment which matches an identifier. In theory, this should
just be <code>\w+</code>. However, from ruby 1.9.2, <code>\w</code> only matches <span class="caps">ASCII</span> characters, while
identifiers can also contain unicode characters. To allow for this, the <code>\p{Word}</code>
character class is used from ruby 1.9.2 onward, while <code>\w</code> is used for previous
versions</p>

  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>RUBY_VERSION</span> <span class='op'>&gt;=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>1.9.2</span><span class='tstring_end'>'</span></span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\p{Word}+</span><span class='tstring_end'>'</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\w+</span><span class='tstring_end'>'</span></span></pre></dd>
      
        <dt id="MULTI_ID_PATTERN-constant" class="">MULTI_ID_PATTERN =
          <div class="docstring">
  <div class="discussion">
    <p>The regexp fragment which matches a multiple identifier (that is, an identifier
maybe followed by several other identifiers separated by <code>::</code>)</p>

  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>IDENTIFIER_PATTERN</span><span class='rbrace'>}</span><span class='tstring_content'>(?:::</span><span class='embexpr_beg'>#{</span><span class='const'>IDENTIFIER_PATTERN</span><span class='rbrace'>}</span><span class='tstring_content'>)*</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="PATTERNS-constant" class="">PATTERNS =
          <div class="docstring">
  <div class="discussion">
    <p>The patterns used to find out whether an <code>end</code> keyword should be inserted after
a line.</p>
<p>Each entry is itself an array with three elements:</p>
<ul>
	<li>the regexp to match agains the line</li>
	<li>the text to insert if the regexp match</li>
	<li>an array with two elements, representing the position where the cursor should be
  moved to after the insertion, as described in <span class='object_link'><a href="Extension/Insertion.html#final_position-instance_method" title="Ruber::AutoEnd::Extension::Insertion#final_position (method)">Insertion#final_position</a></span></li>
</ul>

  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*if\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>=\s*if\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*unless\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>=\s*unless\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\bdo\s*$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\bdo\s+\|</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*def\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\bclass\b</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\bmodule\b</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*case\b</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>=\s*case\b</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*while\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*until\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^=begin(\s|$)</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n=end</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*begin\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(^=\s+|.=\s*)begin\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*for\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>=\s*for\s</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nend</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
<span class='rbracket'>]</span></pre></dd>
      
    </dl>
  


  
  
  
  
  


  
  
  
  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes included from <span class='object_link'><a href="../Extension.html" title="Ruber::Extension (module)">Extension</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Extension.html#plugin-instance_method" title="Ruber::Extension#plugin (method)">plugin</a></span></p>

  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <!-- Provides the  slot annotation -->
<li class="private ">
  <span class="summary_signature">
    
      <a href="#connect_slots-instance_method" title="#connect_slots (instance method)">- (nil) <strong>connect_slots</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  

  
    <span class="summary_desc"><div class='inline'><p>Makes connections to the document&#8217;s signals.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="private ">
  <span class="summary_signature">
    
      <a href="#disconnect_slots-instance_method" title="#disconnect_slots (instance method)">- (nil) <strong>disconnect_slots</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  

  
    <span class="summary_desc"><div class='inline'><p>Disconnects connections to the document&#8217;s signals.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Extension) <strong>initialize</strong>(prj) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of Extension.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="private ">
  <span class="summary_signature">
    
      <a href="#insert_text-instance_method" title="#insert_text (instance method)">- (Object) <strong>insert_text</strong>(insert_pos, lines, dest) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  

  
    <span class="summary_desc"><div class='inline'><p>Inserts text at the given position and moves the cursor to the specified position.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="private ">
  <span class="summary_signature">
    
      <a href="#remove_from_project-instance_method" title="#remove_from_project (instance method)">- (nil) <strong>remove_from_project</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  

  
    <span class="summary_desc"><div class='inline'><p>Override of <span class='object_link'><a href="#remove_from_project-instance_method" title="Ruber::AutoEnd::Extension#remove_from_project (method)">#remove_from_project</a></span>.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="private ">
  <span class="summary_signature">
    
      <a href="#text_changed-instance_method" title="#text_changed (instance method)">- (nil) <strong>text_changed</strong> </a>
    

    
  </span>
  
  
  
    <span class="note title"><strong>slot</strong></span>
  
  <span class="note title private">private</span>
  
  

  
    <span class="summary_desc"><div class='inline'><p>Slot called in response to the <span class='object_link'><a href="../Document.html#text_changed-signalcode" title="Ruber::Document#text_changed (signalcode)">Document#text_changed</a></span> signal.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="private ">
  <span class="summary_signature">
    
      <a href="#text_inserted-instance_method" title="#text_inserted (instance method)">- (Object) <strong>text_inserted</strong>(range) </a>
    

    
  </span>
  
  
  
    <span class="note title"><strong>slot</strong></span>
  
  <span class="note title private">private</span>
  
  

  
    <span class="summary_desc"><div class='inline'><p>Slot called when some text is inserted.</p></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Extension.html" title="Ruber::Extension (module)">Extension</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Extension.html#query_close-instance_method" title="Ruber::Extension#query_close (method)">#query_close</a></span>, <span class='object_link'><a href="../Extension.html#save_settings-instance_method" title="Ruber::Extension#save_settings (method)">#save_settings</a></span>, <span class='object_link'><a href="../Extension.html#shutdown-instance_method" title="Ruber::Extension#shutdown (method)">#shutdown</a></span></p>

  





<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Ruber::AutoEnd::Extension (class)">Extension</a></span></tt>) <strong>initialize</strong>(prj) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>A new instance of Extension</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>prj</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../DocumentProject.html" title="Ruber::DocumentProject (class)">DocumentProject</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the project associated with the document</p></div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'plugins/auto_end/auto_end.rb', line 130</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span> <span class='id prj'>prj</span>
  <span class='kw'>super</span>
  <span class='ivar'>@doc</span> <span class='op'>=</span> <span class='id prj'>prj</span><span class='period'>.</span><span class='id document'>document</span>
  <span class='ivar'>@insertion</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id connect_slots'>connect_slots</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="connect_slots-instance_method">
  
    - (<tt>nil</tt>) <strong>connect_slots</strong>  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Makes connections to the document&#8217;s signals</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'plugins/auto_end/auto_end.rb', line 199</span>

<span class='kw'>def</span> <span class='id connect_slots'>connect_slots</span>
  <span class='id connect'>connect</span> <span class='ivar'>@doc</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text_inserted(KTextEditor::Range, QObject*)</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text_inserted(KTextEditor::Range)</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id connect'>connect</span> <span class='ivar'>@doc</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text_changed(QObject*)</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='symbol'>:text_changed</span><span class='rparen'>)</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="disconnect_slots-instance_method">
  
    - (<tt>nil</tt>) <strong>disconnect_slots</strong>  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Disconnects connections to the document&#8217;s signals</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


209
210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'plugins/auto_end/auto_end.rb', line 209</span>

<span class='kw'>def</span> <span class='id disconnect_slots'>disconnect_slots</span>
  <span class='id disconnect'>disconnect</span> <span class='ivar'>@doc</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text_inserted(KTextEditor::Range, QObject*)</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text_inserted(KTextEditor::Range)</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id disconnect'>disconnect</span> <span class='ivar'>@doc</span><span class='comma'>,</span> <span class='const'>SIGNAL</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text_changed(QObject*)</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='const'>SLOT</span><span class='lparen'>(</span><span class='symbol'>:text_changed</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="insert_text-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>insert_text</strong>(insert_pos, lines, dest)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong> 
    <div class='inline'><p>nothing is done unless the active view (according to <span class='object_link'><a href="../Document.html#active_view-instance_method" title="Ruber::Document#active_view (method)">Document#active_view</a></span>)
is associated with the document</p></div>
  </div>

<p>Inserts text at the given position and moves the cursor to the specified position</p>
<p>To avoid the possibility of infinite recursion, before inserting text <span class='object_link'><a href="#disconnect_slots-instance_method" title="Ruber::AutoEnd::Extension#disconnect_slots (method)">#disconnect_slots</a></span>
is called. After the text has been inserted <span class='object_link'><a href="#connect_slots-instance_method" title="Ruber::AutoEnd::Extension#connect_slots (method)">#connect_slots</a></span> is called.</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>insert_pos</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../KTextEditor/Cursor.html" title="KTextEditor::Cursor (class)">KTextEditor::Cursor</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the position where the text should be inserted</p></div>
      
    </li>
  
    <li>
      
        <span class='name'>lines</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the text to insert</p></div>
      
    </li>
  
    <li>
      
        <span class='name'>dest</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span>(Integer,Integer)</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the position to move the cursor to, relative
to the insertion position, as described in <span class='object_link'><a href="Extension/Insertion.html#final_position-instance_method" title="Ruber::AutoEnd::Extension::Insertion#final_position (method)">Ruber::AutoEnd::Extension::Insertion#final_position</a></span></p></div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'plugins/auto_end/auto_end.rb', line 227</span>

<span class='kw'>def</span> <span class='id insert_text'>insert_text</span> <span class='id insert_pos'>insert_pos</span><span class='comma'>,</span> <span class='id lines'>lines</span><span class='comma'>,</span> <span class='id dest'>dest</span>
  <span class='id view'>view</span> <span class='op'>=</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id active_view'>active_view</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id view'>view</span>
  <span class='id disconnect_slots'>disconnect_slots</span>
  <span class='id replace_pos'>replace_pos</span> <span class='op'>=</span> <span class='const'>KTextEditor</span><span class='op'>::</span><span class='const'>Cursor</span><span class='period'>.</span><span class='id new'>new</span> <span class='id insert_pos'>insert_pos</span><span class='period'>.</span><span class='id line'>line</span><span class='comma'>,</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id line_length'>line_length</span><span class='lparen'>(</span><span class='id insert_pos'>insert_pos</span><span class='period'>.</span><span class='id line'>line</span><span class='rparen'>)</span>
  <span class='id insert_pos'>insert_pos</span><span class='period'>.</span><span class='id column'>column</span> <span class='op'>=</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id line_length'>line_length</span> <span class='id insert_pos'>insert_pos</span><span class='period'>.</span><span class='id line'>line</span>
  <span class='ivar'>@doc</span><span class='period'>.</span><span class='id insert_text'>insert_text</span> <span class='id insert_pos'>insert_pos</span><span class='comma'>,</span> <span class='id lines'>lines</span> 
  <span class='id final_pos'>final_pos</span> <span class='op'>=</span> <span class='const'>KTextEditor</span><span class='op'>::</span><span class='const'>Cursor</span><span class='period'>.</span><span class='id new'>new</span> <span class='id insert_pos'>insert_pos</span><span class='period'>.</span><span class='id line'>line</span> <span class='op'>+</span> <span class='id lines'>lines</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>-</span> <span class='int'>1</span><span class='comma'>,</span>
      <span class='id lines'>lines</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id size'>size</span>
  <span class='id view'>view</span><span class='period'>.</span><span class='id execute_action'>execute_action</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tools_align</span><span class='tstring_end'>'</span></span>
  <span class='id dest_line'>dest_line</span> <span class='op'>=</span> <span class='id insert_pos'>insert_pos</span><span class='period'>.</span><span class='id line'>line</span><span class='op'>+</span><span class='id dest'>dest</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='id dest_col'>dest_col</span> <span class='op'>=</span> <span class='id dest'>dest</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='id dest_col'>dest_col</span> <span class='op'>+=</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id line_length'>line_length</span><span class='lparen'>(</span><span class='id dest_line'>dest_line</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id dest_col'>dest_col</span> <span class='op'>&lt;</span> <span class='int'>0</span>
  <span class='id view'>view</span><span class='period'>.</span><span class='id go_to'>go_to</span> <span class='id dest_line'>dest_line</span><span class='comma'>,</span> <span class='id dest_col'>dest_col</span>
  <span class='id connect_slots'>connect_slots</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="remove_from_project-instance_method">
  
    - (<tt>nil</tt>) <strong>remove_from_project</strong>  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Override of <span class='object_link'><a href="#remove_from_project-instance_method" title="Ruber::AutoEnd::Extension#remove_from_project (method)">#remove_from_project</a></span></p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192
193</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'plugins/auto_end/auto_end.rb', line 191</span>

<span class='kw'>def</span> <span class='id remove_from_project'>remove_from_project</span>
  <span class='id disconnect_slots'>disconnect_slots</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="text_changed-instance_method">
  
    - (<tt>nil</tt>) <strong>text_changed</strong>  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Slot called in response to the <span class='object_link'><a href="../Document.html#text_changed-signalcode" title="Ruber::Document#text_changed (signalcode)">Document#text_changed</a></span> signal</p>
<p>If there&#8217;s an insertion position memorized, inserts the corresponding text after
the current line, then moves the cursor to the position stored with the insertion
object.</p>
<p>The current insertion is forgotten.</p>

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


178
179
180
181
182
183
184</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'plugins/auto_end/auto_end.rb', line 178</span>

<span class='kw'>def</span> <span class='id text_changed'>text_changed</span>
  <span class='kw'>if</span> <span class='ivar'>@insertion</span>
    <span class='id insert_text'>insert_text</span> <span class='const'>KTextEditor</span><span class='op'>::</span><span class='const'>Cursor</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='ivar'>@insertion</span><span class='period'>.</span><span class='id line_number'>line_number</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span><span class='comma'>,</span> 
        <span class='ivar'>@insertion</span><span class='period'>.</span><span class='id lines'>lines</span><span class='comma'>,</span> <span class='ivar'>@insertion</span><span class='period'>.</span><span class='id final_position'>final_position</span>
    <span class='ivar'>@insertion</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>      <h3 style="font-size: 1em; margin-bottom: 0;">Slot Signature:</h3>
      <p style="margin-top: 5pt;"><tt>text_changed()</tt></p>

    
      <div class="method_details ">
  <p class="signature " id="text_inserted-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>text_inserted</strong>(range)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Slot called when some text is inserted</p>
<p>If one of the recognized patterns match the current line, memorizes an <span class='object_link'><a href="Extension/Insertion.html" title="Ruber::AutoEnd::Extension::Insertion (class)">Insertion</a></span>
object pointing to the current line and using the parameters associated with the
matching pattern.</p>
<p>If the inserted text doesn&#8217;t end in a newline, nothing is done.</p>
<p>If the current line doesn&#8217;t match any pattern, the currently memorized insertion
position (if any) is forgotten</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>the</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../KTextEditor/Range.html" title="KTextEditor::Range (class)">KTextEditor::Range</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>range corresponding to the inserted text</p></div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'plugins/auto_end/auto_end.rb', line 151</span>

<span class='kw'>def</span> <span class='id text_inserted'>text_inserted</span> <span class='id range'>range</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id active?'>active?</span>
  <span class='id text'>text</span> <span class='op'>=</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id text'>text</span> <span class='id range'>range</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id text'>text</span><span class='period'>.</span><span class='id end_with?'>end_with?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@insertion</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id line'>line</span> <span class='op'>=</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id line'>line</span><span class='lparen'>(</span> <span class='id range'>range</span><span class='period'>.</span><span class='id end'>end</span><span class='period'>.</span><span class='id line'>line</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='id pattern'>pattern</span> <span class='op'>=</span> <span class='const'>PATTERNS</span><span class='period'>.</span><span class='id find'>find</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id pat'>pat</span><span class='op'>|</span> <span class='id pat'>pat</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id match'>match</span> <span class='id line'>line</span><span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='id pattern'>pattern</span> <span class='kw'>and</span> <span class='op'>!</span><span class='id line'>line</span><span class='period'>.</span><span class='id start_with?'>start_with?</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>#</span><span class='tstring_end'>'</span></span>
    <span class='id check_res'>check_res</span> <span class='op'>=</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id extension'>extension</span><span class='lparen'>(</span><span class='symbol'>:syntax_checker</span><span class='rparen'>)</span><span class='period'>.</span><span class='id check_syntax'>check_syntax</span><span class='lparen'>(</span><span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span> 
        <span class='symbol'>:update</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id check_res'>check_res</span>
    <span class='id errors'>errors</span> <span class='op'>=</span> <span class='id check_res'>check_res</span><span class='lbracket'>[</span><span class='symbol'>:errors</span><span class='rbracket'>]</span>
    <span class='comment'># Usually, missing end errors are the last ones to be reported
</span>    <span class='kw'>if</span> <span class='id errors'>errors</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id errors'>errors</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id errors'>errors</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id error_type'>error_type</span> <span class='op'>==</span> <span class='symbol'>:missing_end</span>
<span class='comment'>#           indentation = line.match(/^\s*/)[0].size
</span><span class='comment'>#           next_indentation = @doc.line(range.end.line + 1).match(/^\s*/)[0].size
</span><span class='comment'>#           unless next_indentation &gt; indentation
</span>      <span class='ivar'>@insertion</span> <span class='op'>=</span> <span class='const'>Insertion</span><span class='period'>.</span><span class='id new'>new</span> <span class='id range'>range</span><span class='period'>.</span><span class='id end'>end</span><span class='period'>.</span><span class='id line'>line</span><span class='comma'>,</span> <span class='id pattern'>pattern</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id pattern'>pattern</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>      <h3 style="font-size: 1em; margin-bottom: 0;">Slot Signature:</h3>
      <p style="margin-top: 5pt;"><tt>text_inserted(KTextEditor::Range)</tt></p>

    
  </div>



</div>
    
    <div id="footer">
  Generated on Sun Oct 23 14:12:22 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.3 (ruby-1.9.3).
</div>

  </body>
</html>