<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Ruber::DocumentProject::Backend
  
    &mdash; Ruber API
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (B)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Ruber.html" title="Ruber (module)">Ruber</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../DocumentProject.html" title="Ruber::DocumentProject (class)">DocumentProject</a></span></span>
     &raquo; 
    <span class="title">Backend</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Ruber::DocumentProject::Backend
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../YamlSettingsBackend.html" title="Ruber::YamlSettingsBackend (class)">YamlSettingsBackend</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next"><span class='object_link'><a href="../YamlSettingsBackend.html" title="Ruber::YamlSettingsBackend (class)">YamlSettingsBackend</a></span></li>
          
            <li class="next">Ruber::DocumentProject::Backend</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/ruber/document_project.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Backend for SettingsContainer used in particular for ProjectDocuments. It mostly
works as YamlSettingsBackend, with the following differences:</p>
<ul>
	<li>it doesn&#8217;t create the file if the only option to be written (that is, the only
  one different from its default value) is the <ins>project_name</ins>. In that case, if
  the file already exists, it is deleted</li>
	<li>it automatically determines the name of the associated file from the name of the
  document</li>
</ul>

  </div>
</div>
<div class="tags">
  

</div>

  
  
  
  


  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#document_path%3D-instance_method" title="#document_path= (instance method)">- (Object) <strong>document_path</strong>(value) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Changes the project name and the file name so that they match a document path of
<em>value</em>.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="private ">
  <span class="summary_signature">
    
      <a href="#file_for-instance_method" title="#file_for (instance method)">- (Object) <strong>file_for</strong>(path) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the file where the data for the document path <em>path</em> should be stored (an
empty string if <em>path</em> is empty).</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Backend) <strong>initialize</strong>(file) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a new DocumentProject::Backend.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#write-instance_method" title="#write (instance method)">- (Object) <strong>write</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Works mostly as <tt>YamlSettingsBackend#write</tt>.</p></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../YamlSettingsBackend.html" title="Ruber::YamlSettingsBackend (class)">YamlSettingsBackend</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../YamlSettingsBackend.html#%5B%5D-instance_method" title="Ruber::YamlSettingsBackend#[] (method)">#[]</a></span>, <span class='object_link'><a href="../YamlSettingsBackend.html#compute_data-instance_method" title="Ruber::YamlSettingsBackend#compute_data (method)">#compute_data</a></span>, <span class='object_link'><a href="../YamlSettingsBackend.html#file-instance_method" title="Ruber::YamlSettingsBackend#file (method)">#file</a></span></p>






<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Ruber::DocumentProject::Backend (class)">Backend</a></span></tt>) <strong>initialize</strong>(file) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Creates a new DocumentProject::Backend. <em>file</em> is the path of the file associated
with the backend.</p>
<p>If <em>file</em> is an invalid project file, the behaviour will be the same as the file
didn&#8217;t exist. This means that it will be overwritten when the project is saved.
The reason for this behaviour is that there should be no user file in the directory
where document projects are saved.</p>

  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62
63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ruber/document_project.rb', line 58</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span> <span class='id file'>file</span>
  <span class='ivar'>@old_files</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>begin</span> <span class='kw'>super</span> <span class='id file_for'>file_for</span><span class='lparen'>(</span><span class='id file'>file</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>InvalidSettingsFile</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="document_path=-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>document_path=</strong>(value) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Changes the project name and the file name so that they match a document path of
<em>value</em>. This means:</p>
<ul>
	<li>setting the project name to <em>value</em></li>
	<li>changing the file associated with the backend to an encoded version of <em>value</em></li>
	<li>adding the old associated file to a list of obsolete files, which will be deleted
  at the next write</li>
</ul>

  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ruber/document_project.rb', line 94</span>

<span class='kw'>def</span> <span class='id document_path='>document_path=</span> <span class='id value'>value</span>
  <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:general</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:general</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:project_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id value'>value</span>
  <span class='ivar'>@old_files</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@filename</span> <span class='kw'>unless</span> <span class='ivar'>@filename</span><span class='period'>.</span><span class='id empty?'>empty?</span>
  <span class='ivar'>@filename</span> <span class='op'>=</span> <span class='id file_for'>file_for</span><span class='lparen'>(</span><span class='id value'>value</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="file_for-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>file_for</strong>(path)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns the file where the data for the document path <em>path</em> should be stored (an
empty string if <em>path</em> is empty).</p>

  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110
111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ruber/document_project.rb', line 107</span>

<span class='kw'>def</span> <span class='id file_for'>file_for</span> <span class='id path'>path</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span> <span class='kw'>if</span> <span class='id path'>path</span><span class='period'>.</span><span class='id empty?'>empty?</span>
  <span class='id dir'>dir</span> <span class='op'>=</span> <span class='const'>KDE</span><span class='op'>::</span><span class='const'>Global</span><span class='period'>.</span><span class='id dirs'>dirs</span><span class='period'>.</span><span class='id locate_local'>locate_local</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>appdata</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>documents/</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id md5'>md5</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='id md5'>md5</span> <span class='op'>&lt;&lt;</span> <span class='id path'>path</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id join'>join</span> <span class='id dir'>dir</span><span class='comma'>,</span> <span class='id md5'>md5</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="write-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>write</strong>(opts) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Works mostly as <tt>YamlSettingsBackend#write</tt>. If the only option to be written
is the project name, the file isn&#8217;t created, if it doesn&#8217;t exist, and is deleted
if it does exist. Also, if there are any obsolete files (see <tt>document_path=</tt>),
they are deleted, too.</p>
<p>If no file name is associated with the backend (that is, if <ins>file</ins> returns an empty string),
a <ins>SystemCall</ins> error (most likely, <tt>Errno::<span class="caps">ENOENT</span></tt>) will be raised</p>

  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81
82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ruber/document_project.rb', line 74</span>

<span class='kw'>def</span> <span class='id write'>write</span> <span class='id opts'>opts</span>
  <span class='id new_data'>new_data</span> <span class='op'>=</span> <span class='id compute_data'>compute_data</span> <span class='id opts'>opts</span>
  <span class='kw'>if</span> <span class='id new_data'>new_data</span><span class='period'>.</span><span class='id has_only_keys?'>has_only_keys?</span><span class='lparen'>(</span><span class='symbol'>:general</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id new_data'>new_data</span><span class='lbracket'>[</span><span class='symbol'>:general</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id has_only_keys?'>has_only_keys?</span><span class='lparen'>(</span><span class='symbol'>:project_name</span><span class='rparen'>)</span>
    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id rm_f'>rm_f</span> <span class='ivar'>@filename</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id open'>open</span><span class='lparen'>(</span><span class='ivar'>@filename</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>w</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span> <span class='id f'>f</span><span class='period'>.</span><span class='id write'>write</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id dump'>dump</span><span class='lparen'>(</span><span class='id new_data'>new_data</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='ivar'>@old_files</span><span class='period'>.</span><span class='id each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span> <span class='const'>FileUtils</span><span class='period'>.</span><span class='id rm_f'>rm_f</span> <span class='id f'>f</span><span class='rbrace'>}</span>
  <span class='ivar'>@old_files</span><span class='period'>.</span><span class='id clear'>clear</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='id new_data'>new_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>



</div>
    
    <div id="footer">
  Generated on Sun Oct 23 14:12:22 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.3 (ruby-1.9.3).
</div>

  </body>
</html>