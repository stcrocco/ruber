<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Ruber::SyntaxChecker::RubySyntaxChecker</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (R)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Ruber.html" title="Ruber (module)">Ruber</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../SyntaxChecker.html" title="Ruber::SyntaxChecker (module)">SyntaxChecker</a></span></span>
     &raquo; 
    <span class="title">RubySyntaxChecker</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Ruber::SyntaxChecker::RubySyntaxChecker
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Ruber::SyntaxChecker::RubySyntaxChecker</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">plugins/syntax_checker/syntax_checker.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Class which checks the syntax of a ruby file.</p>
<p>To do so, it runs a separate ruby process (using the ruby interpreter set by the
Ruby Runner plugin) passing it the <code>-c</code> and the <code>-e</code> options with the document&#8217;s
content as argument.</p>
<p>The process is executed using <code>Open3.popen3</code></p>

  </div>
</div>
<div class="tags">
  
</div>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#check-instance_method" title="#check (instance method)">- (String) <strong>check</strong>(str) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Checks the syntax of the given string.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#convert_check_result-instance_method" title="#convert_check_result (instance method)">- (&lt;SyntaxCheckerPlugin::ErrorDescription&gt;) <strong>convert_check_result</strong>(str) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Parses the output of <span class='object_link'><a href="#check-instance_method" title="Ruber::SyntaxChecker::RubySyntaxChecker#check (method)">RubySyntaxChecker#check</a></span>.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (RubySyntaxChecker) <strong>initialize</strong>(doc) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a new instance.</p></div></span>
  
</li>

      
    </ul>
  







<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Ruber::SyntaxChecker::RubySyntaxChecker (class)">RubySyntaxChecker</a></span></tt>) <strong>initialize</strong>(doc) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Creates a new instance.</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Document.html" title="Ruber::Document (class)">Document</a></span></tt>)</span>
      
      
        <span class='name'>doc</span>
      
      
      
        &mdash;
        <div class='inline'><p>the document to check</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


482
483
484</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'plugins/syntax_checker/syntax_checker.rb', line 482</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span> <span class='id doc'>doc</span>
  <span class='ivar'>@doc</span> <span class='op'>=</span> <span class='id doc'>doc</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="check-instance_method">
  
    - (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>check</strong>(str) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Checks the syntax of the given string.</p>
<p>syntax errors or an empty string if there were no syntax error</p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>str</span>
      
      
      
        &mdash;
        <div class='inline'><p>the string to check (usually, it&#8217;ll be the document&#8217;s text)</p></div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>a string containing the lines of output produced by ruby concerning</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


493
494
495
496
497
498
499
500</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'plugins/syntax_checker/syntax_checker.rb', line 493</span>

<span class='kw'>def</span> <span class='id check'>check</span> <span class='id str'>str</span>
  <span class='id ruby'>ruby</span> <span class='op'>=</span> <span class='const'>Ruber</span><span class='lbracket'>[</span><span class='symbol'>:ruby_development</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id interpreter_for'>interpreter_for</span> <span class='ivar'>@doc</span>
  <span class='const'>Open3</span><span class='period'>.</span><span class='id popen3'>popen3</span><span class='lparen'>(</span><span class='id ruby'>ruby</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>-c</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>-e</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id str'>str</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id in_s'>in_s</span><span class='comma'>,</span> <span class='id out_s'>out_s</span><span class='comma'>,</span> <span class='id err_s'>err_s</span><span class='op'>|</span>
    <span class='id error'>error</span> <span class='op'>=</span> <span class='id err_s'>err_s</span><span class='period'>.</span><span class='id read'>read</span>
    <span class='id error'>error</span><span class='period'>.</span><span class='id gsub!'>gsub!</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^-e(?=:\d+:\s+syntax error,)</span><span class='regexp_end'>}</span></span><span class='comma'>,</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id path'>path</span>
    <span class='id out_s'>out_s</span><span class='period'>.</span><span class='id read'>read</span><span class='period'>.</span><span class='id strip'>strip</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Syntax OK</span><span class='tstring_end'>'</span></span> <span class='op'>?</span> <span class='id error'>error</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="convert_check_result-instance_method">
  
    - (<tt>&lt;<span class='object_link'><a href="SyntaxCheckerPlugin/ErrorDescription.html" title="Ruber::SyntaxChecker::SyntaxCheckerPlugin::ErrorDescription (class)">SyntaxCheckerPlugin::ErrorDescription</a></span>&gt;</tt>) <strong>convert_check_result</strong>(str) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Parses the output of <span class='object_link'><a href="#check-instance_method" title="Ruber::SyntaxChecker::RubySyntaxChecker#check (method)">#check</a></span></p>
<p>corresponding to the syntax errors mentioned in <em>str</em></p>

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>str</span>
      
      
      
        &mdash;
        <div class='inline'><p>the string to parse.</p></div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>&lt;<span class='object_link'><a href="SyntaxCheckerPlugin/ErrorDescription.html" title="Ruber::SyntaxChecker::SyntaxCheckerPlugin::ErrorDescription (class)">SyntaxCheckerPlugin::ErrorDescription</a></span>&gt;</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>a list of <span class='object_link'><a href="SyntaxCheckerPlugin/ErrorDescription.html" title="Ruber::SyntaxChecker::SyntaxCheckerPlugin::ErrorDescription (class)">ErrorDescription</a></span>s</p></div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'plugins/syntax_checker/syntax_checker.rb', line 509</span>

<span class='kw'>def</span> <span class='id convert_check_result'>convert_check_result</span> <span class='id str'>str</span>
  <span class='id groups'>groups</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='id lines'>lines</span> <span class='op'>=</span> <span class='id str'>str</span><span class='period'>.</span><span class='id split'>split</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id lines'>lines</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id l'>l</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id l'>l</span><span class='period'>.</span><span class='id match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^</span><span class='embexpr_beg'>#{</span><span class='const'>Regexp</span><span class='period'>.</span><span class='id quote'>quote</span><span class='lparen'>(</span><span class='ivar'>@doc</span><span class='period'>.</span><span class='id path'>path</span><span class='op'>||</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>:\d+:\s+syntax error,\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='kw'>then</span> <span class='id groups'>groups</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id l'>l</span><span class='rbracket'>]</span>
    <span class='kw'>else</span> <span class='id groups'>groups</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id l'>l</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id groups'>groups</span><span class='period'>.</span><span class='id delete_if'>delete_if</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id g'>g</span><span class='op'>|</span> <span class='id g'>g</span><span class='period'>.</span><span class='id empty?'>empty?</span><span class='rbrace'>}</span>
  <span class='id groups'>groups</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id a'>a</span><span class='op'>|</span>
    <span class='id a'>a</span><span class='period'>.</span><span class='id shift'>shift</span><span class='period'>.</span><span class='id match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^</span><span class='embexpr_beg'>#{</span><span class='const'>Regexp</span><span class='period'>.</span><span class='id quote'>quote</span><span class='lparen'>(</span><span class='ivar'>@doc</span><span class='period'>.</span><span class='id path'>path</span><span class='op'>||</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>:(\d+):\s+syntax error,\s+(.*)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='id msgs'>msgs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='backref'>$2</span><span class='rbracket'>]</span>
    <span class='id error'>error</span> <span class='op'>=</span> <span class='const'>SyntaxCheckerPlugin</span><span class='op'>::</span><span class='const'>ErrorDescription</span><span class='period'>.</span><span class='id new'>new</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id to_i'>to_i</span>
    <span class='kw'>if</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*\^\s*$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
      <span class='id error'>error</span><span class='period'>.</span><span class='id code'>code</span> <span class='op'>=</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span>
<span class='comment'># Sometimes, ruby doesn't report the whole line where the error occurs, but only
</span><span class='comment'># the part nearest it. In this case, the beginning of the line is replaced with ... . 
</span><span class='comment'># In this case, to obtain the correct column number, we try a regexp match
</span><span class='comment'># between the part of code reported by ruby and the whole line. If it works, we
</span><span class='comment'># add that position to the one returned by ruby. If it doesn't (for example because
</span><span class='comment'># the user changed the document in the meantime), we'll just report what ruby reports
</span>      <span class='id col'>col</span> <span class='op'>=</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>^</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> 
      <span class='kw'>if</span> <span class='id a'>a</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\.\.\.</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
        <span class='id lines'>lines</span> <span class='op'>=</span> <span class='ivar'>@doc</span><span class='period'>.</span><span class='id text'>text</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='comment'># error.line is 1-based
</span>        <span class='id l'>l</span> <span class='op'>=</span> <span class='id lines'>lines</span><span class='lbracket'>[</span><span class='id error'>error</span><span class='period'>.</span><span class='id line'>line</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
        <span class='id pos'>pos</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id l'>l</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='embexpr_beg'>#{</span><span class='const'>Regexp</span><span class='period'>.</span><span class='id quote'>quote</span><span class='lparen'>(</span><span class='id a'>a</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
        <span class='id error'>error</span><span class='period'>.</span><span class='id column'>column</span> <span class='op'>=</span> <span class='id pos'>pos</span> <span class='op'>?</span> <span class='id col'>col</span> <span class='op'>+</span> <span class='id pos'>pos</span> <span class='op'>-</span> <span class='int'>1</span> <span class='op'>:</span> <span class='id col'>col</span>
      <span class='kw'>else</span> <span class='id error'>error</span><span class='period'>.</span><span class='id column'>column</span> <span class='op'>=</span> <span class='id col'>col</span>
      <span class='kw'>end</span>
      <span class='id a'>a</span><span class='period'>.</span><span class='id pop'>pop</span> <span class='int'>2</span>
    <span class='kw'>end</span>
    <span class='id a'>a</span><span class='period'>.</span><span class='id each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id l'>l</span><span class='op'>|</span> <span class='id msgs'>msgs</span> <span class='op'>&lt;&lt;</span> <span class='id l'>l</span><span class='rbrace'>}</span>
    <span class='id error'>error</span><span class='period'>.</span><span class='id message'>message</span> <span class='op'>=</span> <span class='id msgs'>msgs</span><span class='period'>.</span><span class='id join'>join</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> </span><span class='tstring_end'>'</span></span>
    <span class='id error'>error</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>



</div>
    
    <div id="footer">
  Generated on Sat Nov  6 13:29:17 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>