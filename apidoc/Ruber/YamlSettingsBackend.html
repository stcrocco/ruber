<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Ruber::YamlSettingsBackend</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (Y)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Ruber.html" title="Ruber (module)">Ruber</a></span></span>
     &raquo; 
    <span class="title">YamlSettingsBackend</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Ruber::YamlSettingsBackend
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Ruber::YamlSettingsBackend</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/ruber/yaml_option_backend.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Backend for <tt>SettingsContainer</tt> which writes the options to a <span class="caps">YAML</span> file,
as a nested hash, where the outer hash contains the groups and each inner hash,
which represents a group, contains the options. Here&#8217;s an example of the <span class="caps">YAML</span>
file produced by this class.</p>
:group1:
:opt1: value1
:opt2: value2
:opt3: value3
:group2:
:opt1: value4
:opt4: value5
:group3:
:opt5: value6

  </div>
</div>
<div class="tags">
  
</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="DocumentProject/Backend.html" title="Ruber::DocumentProject::Backend (class)">DocumentProject::Backend</a></span></p>
</div>
<h2>Defined Under Namespace</h2>
<p class="children">
   
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="YamlSettingsBackend/InvalidSettingsFile.html" title="Ruber::YamlSettingsBackend::InvalidSettingsFile (class)">InvalidSettingsFile</a></span>
    
  
</p>



  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#%5B%5D-instance_method" title="#[] (instance method)">- (Object) <strong>[]</strong>(opt) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the option corresponding to <em>opt</em>.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="private ">
  <span class="summary_signature">
    
      <a href="#compute_data-instance_method" title="#compute_data (instance method)">- (Object) <strong>compute_data</strong>(options) </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a hash with the options to be written to file.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#file-instance_method" title="#file (instance method)">- (Object) <strong>file</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The name of the file associated with the backend.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (YamlSettingsBackend) <strong>initialize</strong>(file) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a new YamlSettingsBackend corresponding to the <span class="caps">YAML</span> file with name <em>file</em>.</p></div></span>
  
</li>

      
        <!-- Provides the  slot annotation -->
<li class="public ">
  <span class="summary_signature">
    
      <a href="#write-instance_method" title="#write (instance method)">- (Object) <strong>write</strong>(options) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Writes the options back to the <span class="caps">YAML</span> file (creating it if needed).</p></div></span>
  
</li>

      
    </ul>
  







<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Ruber::YamlSettingsBackend (class)">YamlSettingsBackend</a></span></tt>) <strong>initialize</strong>(file) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Creates a new YamlSettingsBackend corresponding to the <span class="caps">YAML</span> file with name <em>file</em>.
If the file exists, it&#8217;s parsed and the content is stored internally in a hash.
If it doesn&#8217;t exist, the object is initialized with a new hash.</p>
<p>If the file exists but isn&#8217;t a valid <span class="caps">YAML</span> file, or if it doesn&#8217;t contain a toplevel
hash, InvalidSettingsFile is raised. In this case, however, the object will be
fully initialized (with an empty hash) before the exception is raised. This means
that a class deriving from YamlSettingsBackend which wants to ignore errors due to
an invalid project file can simply do the following:</p>
<p>class CustomSettingsBackend &lt; Ruber::Yaml::SettingsBackend</p>
def initialize file
begin super
rescue Ruber::YamlSettingsBackend::InvalidSettingsFile
end
end

<p>end</p>
<p>This way</p>
CustomSettingsBackend.new(&#8216;/path/to/invalid_file&#8217;)

<p>will return an option backend fully initialized. (This happens because of how
Class.new works: the object is first allocated, then its initialize method is called
and the object is returned. If an exception raised by initialize is rescued within
the initialize method, Class.new will never notice something went wrong and still
return the allocated object)</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84
85
86
87
88
89
90
91
92
93
94</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ruber/yaml_option_backend.rb', line 80</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span> <span class='id file'>file</span>
  <span class='ivar'>@filename</span> <span class='op'>=</span> <span class='id file'>file</span>
  <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id exist?'>exist?</span> <span class='id file'>file</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='kw'>begin</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id load'>load</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id read'>read</span><span class='lparen'>(</span><span class='id file'>file</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>ArgumentError</span> <span class='op'>=&gt;</span> <span class='id e'>e</span>
      <span class='ivar'>@data</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='id raise'>raise</span> <span class='const'>InvalidSettingsFile</span><span class='comma'>,</span> <span class='id e'>e</span><span class='period'>.</span><span class='id message'>message</span>
    <span class='kw'>end</span>
    <span class='kw'>unless</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>Hash</span>
      <span class='ivar'>@data</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='id raise'>raise</span> <span class='const'>InvalidSettingsFile</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The file </span><span class='embexpr_beg'>#{</span><span class='id file'>file</span><span class='rbrace'>}</span><span class='tstring_content'> isn\'t a valid option file</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span> <span class='ivar'>@data</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="[]-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>[]</strong>(opt) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Returns the option corresponding to <em>opt</em>. <em>opt</em> is an option object with
the characteristics specified in SettingsContainer#add_option. If an option with
the same name and value of <em>opt</em> isn&#8217;t included in the internal hash, the option
default value will be returned</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ruber/yaml_option_backend.rb', line 110</span>

<span class='kw'>def</span> <span class='op'>[]</span> <span class='id opt'>opt</span>
  <span class='id grp'>grp</span> <span class='op'>=</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id fetch'>fetch</span><span class='lparen'>(</span><span class='id opt'>opt</span><span class='period'>.</span><span class='id group'>group</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='kw'>return</span> <span class='id opt'>opt</span><span class='period'>.</span><span class='id default'>default</span><span class='period'>.</span><span class='id deep_copy'>deep_copy</span><span class='rbrace'>}</span>
  <span class='id grp'>grp</span><span class='period'>.</span><span class='id fetch'>fetch</span><span class='lparen'>(</span><span class='id opt'>opt</span><span class='period'>.</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id opt'>opt</span><span class='period'>.</span><span class='id default'>default</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="compute_data-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>compute_data</strong>(options)  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Creates a hash with the options to be written to file. See <ins>write</ins> for a more detailed
description of how this happens</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ruber/yaml_option_backend.rb', line 139</span>

<span class='kw'>def</span> <span class='id compute_data'>compute_data</span> <span class='id options'>options</span>
  <span class='id new_data'>new_data</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id h'>h</span><span class='comma'>,</span> <span class='id k'>k</span><span class='op'>|</span> <span class='id h'>h</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rbrace'>}</span>
  <span class='id removed'>removed</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id options'>options</span><span class='period'>.</span><span class='id each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id k'>k</span><span class='comma'>,</span> <span class='id v'>v</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id v'>v</span> <span class='op'>!=</span> <span class='id k'>k</span><span class='period'>.</span><span class='id default'>default</span> <span class='kw'>then</span> <span class='id new_data'>new_data</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='period'>.</span><span class='id group'>group</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='period'>.</span><span class='id name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id v'>v</span>
    <span class='kw'>else</span> <span class='id removed'>removed</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id k'>k</span><span class='period'>.</span><span class='id group'>group</span><span class='comma'>,</span> <span class='id k'>k</span><span class='period'>.</span><span class='id name'>name</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@data</span><span class='period'>.</span><span class='id each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id grp'>grp</span><span class='comma'>,</span> <span class='id data'>data</span><span class='op'>|</span>
    <span class='id data'>data</span><span class='period'>.</span><span class='id each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id opt'>opt</span><span class='comma'>,</span> <span class='id val'>val</span><span class='op'>|</span>
      <span class='kw'>unless</span> <span class='id removed'>removed</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id grp'>grp</span><span class='comma'>,</span> <span class='id opt'>opt</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id new_data'>new_data</span><span class='lbracket'>[</span><span class='id grp'>grp</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id opt'>opt</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id val'>val</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id new_data'>new_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="file-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>file</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>The name of the file associated with the backend. Note that there&#8217;s no warranty
the file actually exists.</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ruber/yaml_option_backend.rb', line 100</span>

<span class='kw'>def</span> <span class='id file'>file</span>
  <span class='ivar'>@filename</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="write-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>write</strong>(options) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>Writes the options back to the <span class="caps">YAML</span> file (creating it if needed). <em>options</em> is a
hash with option objects as keys and the corresponding values as entries. There
are two issues to be aware of:</p>
<ul>
	<li>if one of the options in <em>options</em> has a value which is equal to its default
  value, it won&#8217;t be written to file</li>
	<li><em>options</em> is interpreted as only containing the options which might have changed:
  any option contained in the internal hash but not in <em>options</em> is written back
  to the file unchanged.</li>
</ul>
<p>After having written the new options back to file, the internal hash is updated</p>

  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129
130
131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ruber/yaml_option_backend.rb', line 127</span>

<span class='kw'>def</span> <span class='id write'>write</span> <span class='id options'>options</span>
  <span class='id new_data'>new_data</span> <span class='op'>=</span> <span class='id compute_data'>compute_data</span> <span class='id options'>options</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id open'>open</span><span class='lparen'>(</span><span class='ivar'>@filename</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>w</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span> <span class='id f'>f</span><span class='period'>.</span><span class='id write'>write</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id dump'>dump</span><span class='lparen'>(</span><span class='id new_data'>new_data</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='id new_data'>new_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>



</div>
    
    <div id="footer">
  Generated on Tue Jan 11 14:26:52 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.4 (ruby-1.9.2).
</div>

  </body>
</html>